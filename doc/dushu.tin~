#var last_sleep_time @fn_get_time{};
#var last_awake_time @fn_get_time{};
#var curr_sleep_time @fn_get_time{};
#var curr_awake_time @fn_get_time{};
#var can_sleep 1;

#FUNCTION {fn_get_time}
{
	#format result {%T}
}

#FUNCTION {fn_interval}
{
	#if {%1 > %2}
	{
		#math result {%1 - %2}
	};
	#else
	{
		#math result {%2 - %1}
	}
}

#FUNCTION {fn_time2str}
{
	#format {result}{%t}{{%T}{%1}}
}

#FUNCTION {fn_recover}
{

	#unticker dushu;
	#send eat gan liang;
	#send drink jiudai;
	#if {$can_sleep == 1}
	{
		set_action 睡觉中;
		#delay {dl_dushu}{start_dushu_ticker 1;}{40};
		hpbrief;
		#send sleep;
	}
	{
		set_action 等待睡觉;
		hpbrief;
		exert regenerate;
		start_dushu_ticker 1;
		#undelay dl_dushu;
	}
	#return {}
}

#act {^这里不是你能睡的地方！$}
{
	#var can_sleep 0;
	#var result @fn_recover{};
}

#ACTION {%*{你已经很累了，歇歇再读吧，身体要紧|你今天太累了}%*}
{
	#var result @fn_recover{}
}
{5}

#ACTION {%*你现在过于疲倦，无法专心下来研读新知%*}
{
	#var result @fn_recover{}
}
{5}

#ACTION {^你的精神%*不%*}
{
	#var result @fn_recover{}
}
{5}

#ACTION {%*你的体力太低%*}
{
	#var result @fn_recover{}
}
{5}

#ACTION {%*你的体力不够练%*}
{
	#var result @fn_recover{}
}
{5}

#ACTION {%*不一会儿，你就进入了梦乡%*}
{
	#var last_sleep_time $curr_sleep_time;
	#format curr_sleep_time {%T};
	@fn_log{开始睡觉 since @fn_time2str{$curr_awake_time} awake elapsed @fn_interval{$curr_awake_time;$curr_sleep_time}s;true}
}
{5}

#ACTION {%*醒来，精神抖擞%*}
{
	hpbrief;
	#var last_awake_time $curr_awake_time;
	#var curr_awake_time @fn_get_time{};
	@fn_log{睡觉醒来 from @fn_time2str{$curr_sleep_time} elapsed @fn_interval{$curr_awake_time;$curr_sleep_time}s;true};
	start_dushu_ticker 1;
}
{5}

#ACTION {%*在三分钟内睡过一觉, 多睡对身体有害无益%*}
{
	set_action 等待中;
	hpbrief;
	@fn_log{睡觉CD中 since @fn_time2str{$curr_awake_time} awake elapsed @fn_interval{$curr_awake_time;@fn_get_time{}}s;true}
}
{5}

#alias {start_dushu_ticker}{set_action 读书中;#ticker {dushu}{#send $dushu_cmd}{%1}};

start_dushu_ticker 1;
