#var last_sleep_time {@fn_get_time{}};
#var last_awake_time {@fn_get_time{}};
#var curr_sleep_time {@fn_get_time{}};
#var curr_awake_time {@fn_get_time{}};
#var path_to_sleep {d;sd;e;n};
#var path_to_lingwu {s;w;nu;u};
#var lianxi_cnt 10
#var lingw_cnt 20;

#var flag_recover {0};

#FUNCTION {fn_get_time}
{
	#format result {%T}
}

#FUNCTION {fn_interval}
{
	#if {%1 > %2}
	{
		#math result {%1 - %2}
	};
	#else
	{
		#math result {%2 - %1}
	}
}

#FUNCTION {fn_time2str}
{
	#format {result}{%t}{{%T}{%1}}
}

#FUNCTION {fn_gotosleep}
{
	#path load $path_to_sleep;
	#path run;
	#ticker {tk_waitsleep}{#send sleep}{5};
	#return {}
}

#FUNCTION {fn_gotolingwu}
{
	#path load $path_to_lingwu;
	#path run;
	#return {}
}

#FUNCTION {fn_fallinsleep}
{
	#if {$flag_sleeping != 1}
	{
		#var flag_sleeping 1;
		#unticker tk_waitsleep;
		#var last_sleep_time $curr_sleep_time;
		#format curr_sleep_time {%T};
		@fn_log{开始睡觉 since @fn_time2str{$curr_awake_time} awake elapsed @fn_interval{$curr_awake_time;$curr_sleep_time}s;true};
		#delay {dl_wakeup}{#var result @fn_log{人工醒来，精神抖擞;true}}{100}
	};

	#return {}
}

#FUNCTION {fn_recover_spirit}
{
	#if {$flag_recover == 0}
	{
	#var flag_recover 1;
	#unticker lianxi;
	#unticker lingw;
	#send eat gan liang;
	#send drink jiudai;
	#nop #send exert jing;
	#var result @fn_gotosleep{};
	#nop #delay {dl_lingw}{#ticker lingw {lingwu $wugong 30}{1}}{62};
	};
	#elseif {$flag_recover == 1}
	{
		@fn_log{已经在进行体力恢复，不用重复进行;true};
	};
	
	#return {}
}

#FUNCTION {fn_recover_strength}
{
	#math lianxi_cnt $lianxi_cnt + 1;

	#unticker lianxi;
	#if {$lianxi_cnt % 3 == 0}
	{
		#nop #showme <129>===>体力太低满3次，吃喝打坐<===;
		@fn_log{体力太低满3次，吃喝打坐;true};

		#send eat gan liang;
		#send drink jiudai;
		#send exert qi;
		#delay {dl_dazuo}{dazuo 700}{62};
		#delay {dl_lianxi}{#TICKER lianxi {lian $wugong 10}{1}}{124}
	};
	#else
	{
		#nop #showme <129>===>体力太低第 $lianxi_cnt 次<===;
		@fn_log{体力太低第 $lianxi_cnt 次;true};

		#send exert qi;
		#delay {dl_lianxi}{#TICKER lianxi {lian $wugong 10}{1}}{62}
	};

	#return {}
}

#ACTION {%*你减缓真气运行，让自身恢复正常%*}
{
	#nop #showme <129>===>运气恢复精神结束<===;
	@fn_log{运气恢复精神结束;true}
}
{5}

#ACTION {%*你减缓真气运行，让气血运行恢复正常%*}
{
	#nop #showme <129>===>运气恢复体力结束<===;
	@fn_log{运气恢复体力结束;true}
}
{5}

#ACTION {%*不能通过练习来提高%*}
{
	@fn_log{开始领悟基本功;true};
	#unticker lianxi;
	#nop #delay {dl_lingw}{;
	#ticker lingw {lingwu $wugong 30}{1}
	#nop }{2};
}
{5}

#ACTION {%*你的基本功夫比你的高级功夫还高%*}
{
	@fn_log{开始练武功;true};
	#unticker lingw;
	#delay {dl_lianxi}{#TICKER lianxi {lian $wugong 4}{1}}{2}
}
{5}

#act {练%*必须空手。}
{
    unwield all
}

#ACTION {%*你需要提高基本功%*}
{
	@fn_log{开始领悟基本功;true};
	#unticker lianxi;
	#delay {dl_lingw}{#ticker lingw {lingwu $wugong 30}{1}}{2}
}
{5}

#ACTION {%*无法静下心来领悟%*}
{
	#var result @fn_recover_spirit{}
}
{5}

#ACTION {%*你领悟了{一|二}次%*}
{
	#var result @fn_recover_spirit{}
}
{5}

#ACTION {%*获得了少许进步%*}
{
	#nop #var result @fn_recover_strength{};
	#var result @fn_recover_spirit{}
}
{5}

#ACTION {^你的体力%*不能练%*}
{
	#var result @fn_recover_spirit{}
}
{5}

#ACTION {%*你的体力太低%*}
{
	#nop #var result @fn_recover_strength{};
	#var result @fn_recover_spirit{}
}
{5}

#ACTION {%*你的体力不够%*}
{
	#nop #var result @fn_recover_strength{};
	#var result @fn_recover_spirit{}
}
{5}

#ACTION {%*你现在精不够%*}
{
	#nop #showme <129>===>精不够,恢复精神再打坐<===;
	@fn_log{精不够,恢复精神再打坐;true};

	#undelay dl_dazuo;
	#undelay dl_lianxi;
	#send exert jing;
	#delay {dl_dazuo}{dazuo 700}{62};
	#delay {dl_lianxi}{#TICKER lianxi {lian $wugong 10}{1}}{124}
}
{5}

#ACTION {%*牛皮酒袋%*一滴也不剩%*}
{
	#nop #send drop jiudai;
	#nop #send get jiudai from bao;
	@fn_log{牛皮酒袋喝干了;true};
}
{5}

#ACTION {%*你的内力不够%*}
{
	#unticker lianxi;
	#send dazuo 700;
	#delay {dl_lianxi}{#TICKER lianxi {lian $wugong 10}{1}}{62}
}
{5}

#ACTION {%*你现在的气太少了%*}
{
	#delay 64 unticker lianxi;
	#send dazuo 700;
	#delay {dl_lianxi}{#TICKER lianxi {lian $wugong 10}{1}}{70}
}
{5}

#ACTION {%*你往床上一躺，开始睡觉%*}
{
	#var result @fn_fallinsleep{}
}
{5}

#ACTION {%*不一会儿，你就进入了梦乡%*}
{
	#var result @fn_fallinsleep{}
}
{4}

#ACTION {%*醒来，精神抖擞%*}
{
	#var flag_sleeping 0;
	#var flag_recover 0;
	#undelay dl_wakeup;
	#var last_awake_time $curr_awake_time;
	#var curr_awake_time @fn_get_time{};
	@fn_log{睡觉醒来 from @fn_time2str{$curr_sleep_time} elapsed @fn_interval{$curr_awake_time;$curr_sleep_time}s;true};
	#var result @fn_gotolingwu{};
	#delay {dl_lingw}{#ticker lingw {$action $wugong 30}{1}}{3}
}
{5}

#ACTION {%*在三分钟内睡过一觉, 多睡对身体有害无益%*}
{
	#ticker {tk_waitsleep}{#send sleep}{5};
	@fn_log{睡觉CD中 since @fn_time2str{$curr_awake_time} awake elapsed @fn_interval{$curr_awake_time;@fn_get_time{}}s;true}
}
{5}

#TICKER lianxi {$action $wugong 15}{1}
